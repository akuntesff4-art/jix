<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ForexBot ‚Äî AI Trading Analysis Console</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #020202;
    --green: #00ff7f;
    --green-glow: #00ff7f;
    --muted: #0b3b28;
    --panel-bg: rgba(0, 0, 0, 0.75);
    --glass: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    --neon-glow: 0 0 10px rgba(0,255,127,0.7), 0 0 20px rgba(0,255,127,0.5), 0 0 30px rgba(0,255,127,0.3);
  }
  
  * { 
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    font-family: 'Share Tech Mono', monospace;
    color: var(--green);
    -webkit-font-smoothing: antialiased;
    overflow: auto;
    transition: all 0.5s ease;
  }

  /* Matrix Background */
  #matrix {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    filter: contrast(1.3) brightness(0.9) blur(0.3px);
    opacity: 0.7;
  }

  /* Menu Button */
  .menu-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0,255,127,0.2);
    color: var(--green);
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.3s ease;
  }

  .menu-btn:hover {
    box-shadow: var(--neon-glow);
    transform: scale(1.1);
  }

  /* Dropdown Menu */
  .dropdown-menu {
    position: fixed;
    top: 70px;
    left: 20px;
    z-index: 1000;
    background: var(--panel-bg);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0,255,127,0.2);
    border-radius: 12px;
    padding: 10px 0;
    min-width: 200px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    display: none;
    animation: slideDown 0.3s ease;
  }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .dropdown-menu.show {
    display: block;
  }

  .menu-item {
    padding: 12px 20px;
    color: var(--green);
    text-decoration: none;
    display: block;
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
    cursor: pointer;
  }

  .menu-item:hover {
    background: rgba(0,255,127,0.1);
    border-left-color: var(--green);
    padding-left: 25px;
  }

  /* Theme Options */
  .theme-options {
    display: none;
    padding: 15px;
    background: rgba(0,0,0,0.3);
    margin: 10px;
    border-radius: 8px;
    animation: fadeIn 0.3s ease;
  }

  .theme-options.show {
    display: block;
  }

  .theme-btn {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    background: rgba(0,255,127,0.1);
    border: 1px solid rgba(0,255,127,0.3);
    color: var(--green);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Share Tech Mono', monospace;
  }

  .theme-btn:hover {
    background: rgba(0,255,127,0.2);
    transform: translateX(5px);
  }

  /* Login Container */
  .login-container {
    position: relative;
    z-index: 2;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    animation: fadeIn 1s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .login-box {
    background: var(--panel-bg);
    backdrop-filter: blur(20px);
    padding: 40px;
    border-radius: 20px;
    border: 1px solid rgba(0,255,127,0.2);
    box-shadow: var(--neon-glow);
    width: 100%;
    max-width: 400px;
    text-align: center;
    transition: all 0.3s ease;
  }

  .login-box:hover {
    box-shadow: 0 0 30px rgba(0,255,127,0.8), 0 0 50px rgba(0,255,127,0.4);
    transform: translateY(-5px);
  }

  .brand {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 10px;
    background: linear-gradient(45deg, #00ff7f, #00cc66, #00ff7f);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-size: 200% 200%;
    animation: shimmer 3s ease-in-out infinite;
  }

  @keyframes shimmer {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .subtitle {
    color: rgba(0,255,127,0.8);
    margin-bottom: 30px;
    font-size: 14px;
  }

  .input-group {
    margin-bottom: 20px;
    text-align: left;
  }

  .input-group label {
    display: block;
    margin-bottom: 8px;
    color: rgba(0,255,127,0.9);
    font-size: 14px;
  }

  .input-group input {
    width: 100%;
    padding: 15px;
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(0,255,127,0.3);
    border-radius: 10px;
    color: var(--green);
    font-family: 'Share Tech Mono', monospace;
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .input-group input:focus {
    outline: none;
    border-color: rgba(0,255,127,0.8);
    box-shadow: 0 0 15px rgba(0,255,127,0.4);
    background: rgba(0,0,0,0.7);
  }

  .login-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, rgba(0,255,127,0.2), rgba(0,255,127,0.1));
    border: 1px solid rgba(0,255,127,0.4);
    border-radius: 10px;
    color: var(--green);
    font-family: 'Share Tech Mono', monospace;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .login-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0,255,127,0.2), transparent);
    transition: left 0.5s ease;
  }

  .login-btn:hover::before {
    left: 100%;
  }

  .login-btn:hover {
    background: linear-gradient(135deg, rgba(0,255,127,0.3), rgba(0,255,127,0.2));
    box-shadow: 0 0 20px rgba(0,255,127,0.5);
    transform: translateY(-2px);
  }

  .error-message {
    color: #ff4444;
    margin-top: 15px;
    font-size: 13px;
    min-height: 20px;
    text-shadow: 0 0 10px rgba(255,68,68,0.5);
    animation: shake 0.5s ease;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }

  /* Booting Screen */
  .booting-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    z-index: 3000;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: var(--green);
    font-family: 'Share Tech Mono', monospace;
  }

  .booting-screen.active {
    display: flex;
    animation: fadeIn 0.5s ease;
  }

  .booting-content {
    max-width: 600px;
    width: 90%;
    background: var(--panel-bg);
    backdrop-filter: blur(20px);
    padding: 30px;
    border-radius: 15px;
    border: 1px solid rgba(0,255,127,0.2);
    box-shadow: var(--neon-glow);
  }

  .booting-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .booting-title {
    font-size: 24px;
    margin-bottom: 10px;
    background: linear-gradient(45deg, #00ff7f, #00cc66);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .booting-progress {
    width: 100%;
    height: 4px;
    background: rgba(0,255,127,0.1);
    border-radius: 2px;
    overflow: hidden;
    margin: 20px 0;
  }

  .booting-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #00ff7f, #00cc66);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 2px;
  }

  .booting-steps {
    margin-top: 20px;
  }

  .booting-step {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 8px;
    background: rgba(0,255,127,0.05);
    transition: all 0.3s ease;
  }

  .booting-step.active {
    background: rgba(0,255,127,0.1);
    border-left: 3px solid var(--green);
  }

  .booting-step.completed {
    background: rgba(0,255,127,0.08);
    opacity: 0.8;
  }

  .step-icon {
    width: 20px;
    height: 20px;
    margin-right: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .step-text {
    flex: 1;
    font-size: 14px;
  }

  .step-status {
    font-size: 12px;
    color: rgba(0,255,127,0.7);
  }

  .booting-error {
    display: none;
    background: rgba(255,68,68,0.1);
    border: 1px solid rgba(255,68,68,0.3);
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    text-align: center;
  }

  .booting-error.active {
    display: block;
    animation: shake 0.5s ease;
  }

  .error-icon {
    font-size: 24px;
    margin-bottom: 10px;
  }

  /* Main App Container (Hidden Initially) */
  .app {
    position: relative;
    z-index: 2;
    min-height: 100vh;
    display: none;
    flex-direction: column;
    gap: 20px;
    padding: 20px;
    align-items: center;
  }

  .app.active {
    display: flex;
    animation: fadeIn 1s ease-out;
  }

  /* Enhanced Header */
  header {
    width: min(1200px, 96%);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    border-radius: 16px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0,255,127,0.1);
    box-shadow: var(--neon-glow);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0,255,127,0.1), transparent);
    transition: left 0.6s ease;
  }

  header:hover::before {
    left: 100%;
  }

  header:hover {
    box-shadow: 0 0 25px rgba(0,255,127,0.8), 0 0 40px rgba(0,255,127,0.4);
    transform: translateY(-2px);
  }

  /* Enhanced Main Panel */
  .panel {
    width: min(1200px, 96%);
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 20px;
    align-items: stretch;
    transition: all 0.3s ease;
  }

  /* Enhanced Chat Panel */
  .chat-wrap {
    background: var(--panel-bg);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    padding: 20px;
    border: 1px solid rgba(0,255,127,0.08);
    display: flex;
    flex-direction: column;
    gap: 16px;
    min-height: 70vh;
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255,255,255,0.1);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .chat-wrap:hover {
    border-color: rgba(0,255,127,0.15);
    box-shadow: 
      0 12px 40px rgba(0,255,127,0.1),
      inset 0 1px 0 rgba(255,255,255,0.15);
  }

  .chat-window {
    flex: 1;
    overflow: auto;
    padding-right: 8px;
    scroll-behavior: smooth;
    max-height: 60vh;
  }

  .chat-window::-webkit-scrollbar {
    width: 6px;
  }

  .chat-window::-webkit-scrollbar-track {
    background: rgba(0,255,127,0.05);
    border-radius: 10px;
  }

  .chat-window::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(0,255,127,0.3), rgba(0,255,127,0.1));
    border-radius: 10px;
    border: 1px solid rgba(0,255,127,0.1);
  }

  .chat-window::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, rgba(0,255,127,0.5), rgba(0,255,127,0.2));
  }

  /* Enhanced Messages */
  .msg {
    display: inline-block;
    padding: 14px 18px;
    margin: 12px 0;
    border-radius: 14px;
    max-width: 85%;
    white-space: pre-wrap;
    line-height: 1.5;
    word-break: break-word;
    animation: messageSlide 0.3s ease-out;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  @keyframes messageSlide {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .msg::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.6s ease;
  }

  .msg:hover::before {
    left: 100%;
  }

  .msg.ai {
    background: linear-gradient(135deg, rgba(0,255,127,0.08), rgba(0,255,127,0.03));
    color: var(--green);
    border-left: 4px solid rgba(0,255,127,0.6);
    box-shadow: 0 4px 20px rgba(0,255,127,0.1);
    border-radius: 14px 14px 14px 4px;
  }

  .msg.user {
    margin-left: auto;
    background: linear-gradient(135deg, rgba(0,255,127,0.15), rgba(0,255,127,0.05));
    color: #ffffff;
    border-right: 4px solid rgba(0,255,127,0.3);
    box-shadow: 0 4px 20px rgba(0,255,127,0.1);
    border-radius: 14px 14px 4px 14px;
  }

  .msg.system {
    text-align: center;
    background: linear-gradient(135deg, rgba(0,100,255,0.1), rgba(0,50,255,0.05));
    color: rgba(100,200,255,0.9);
    border: 1px solid rgba(100,200,255,0.2);
    margin: 0 auto;
    max-width: 90%;
  }

  .msg.error {
    background: linear-gradient(135deg, rgba(255,50,50,0.1), rgba(255,0,0,0.05));
    color: #ff6b6b;
    border-left: 4px solid rgba(255,50,50,0.6);
    box-shadow: 0 4px 20px rgba(255,50,50,0.1);
  }

  .msg.trade-buy {
    background: linear-gradient(135deg, rgba(0,255,127,0.15), rgba(0,255,127,0.05));
    color: #00ff7f;
    border-left: 4px solid rgba(0,255,127,0.6);
    box-shadow: 0 4px 20px rgba(0,255,127,0.2);
  }

  .msg.trade-sell {
    background: linear-gradient(135deg, rgba(255,50,50,0.15), rgba(255,0,0,0.05));
    color: #ff6b6b;
    border-left: 4px solid rgba(255,50,50,0.6);
    box-shadow: 0 4px 20px rgba(255,50,50,0.2);
  }

  .msg-image {
    max-width: 100%;
    border-radius: 8px;
    margin-top: 8px;
    border: 1px solid rgba(0,255,127,0.2);
  }

  /* Enhanced Composer */
  .composer {
    display: flex;
    gap: 12px;
    align-items: center;
    position: relative;
  }

  .composer input {
    flex: 1;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(0,255,127,0.2);
    padding: 16px 18px;
    border-radius: 12px;
    color: var(--green);
    outline: none;
    font-size: 15px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .composer input:focus {
    border-color: rgba(0,255,127,0.6);
    box-shadow: 0 0 20px rgba(0,255,127,0.3);
    background: rgba(0, 0, 0, 0.6);
    transform: translateY(-1px);
  }

  .composer input::placeholder {
    color: rgba(0,255,127,0.5);
  }

  .composer button {
    background: linear-gradient(135deg, rgba(0,255,127,0.2), rgba(0,255,127,0.1));
    color: var(--green);
    border: 1px solid rgba(0,255,127,0.3);
    padding: 14px 20px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
    font-size: 14px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
  }

  .composer button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0,255,127,0.2), transparent);
    transition: left 0.5s ease;
  }

  .composer button:hover::before {
    left: 100%;
  }

  .composer button:hover:not(:disabled) {
    background: linear-gradient(135deg, rgba(0,255,127,0.3), rgba(0,255,127,0.2));
    border-color: rgba(0,255,127,0.5);
    box-shadow: 0 0 20px rgba(0,255,127,0.4);
    transform: translateY(-2px);
  }

  .composer button:active:not(:disabled) {
    transform: translateY(0);
  }

  .composer button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none !important;
  }

  /* Enhanced Sidebar */
  .sidebar {
    background: var(--glass);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 20px;
    border: 1px solid rgba(0,255,127,0.08);
    min-height: 70vh;
    display: flex;
    flex-direction: column;
    gap: 16px;
    transition: all 0.3s ease;
    overflow-y: auto;
    max-height: 70vh;
  }

  .sidebar:hover {
    border-color: rgba(0,255,127,0.15);
    box-shadow: 0 8px 32px rgba(0,255,127,0.1);
  }

  .panel-title {
    font-size: 15px;
    margin-bottom: 8px;
    color: var(--green);
    text-shadow: 0 0 8px rgba(0,255,127,0.5);
    font-weight: 600;
  }

  .key-list {
    font-size: 13px;
    color: rgba(0,255,127,0.9);
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .key-item {
    padding: 12px;
    background: rgba(0,255,127,0.05);
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    gap: 10px;
    align-items: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(0,255,127,0.1);
  }

  .key-item:hover {
    background: rgba(0,255,127,0.08);
    border-color: rgba(0,255,127,0.2);
    transform: translateX(4px);
  }

  .small-btn {
    background: rgba(0,255,127,0.1);
    border: 1px solid rgba(0,255,127,0.2);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    color: var(--green);
    font-size: 12px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .small-btn:hover {
    background: rgba(0,255,127,0.2);
    border-color: rgba(0,255,127,0.4);
    box-shadow: 0 0 12px rgba(0,255,127,0.3);
    transform: translateY(-1px);
  }

  /* Enhanced Footer */
  .dev-credit {
    width: min(1200px, 96%);
    text-align: center;
    color: var(--green);
    text-shadow: 0 0 20px rgba(0,255,127,0.8);
    font-size: 14px;
    padding: 16px;
    background: var(--glass);
    backdrop-filter: blur(15px);
    border-radius: 12px;
    border: 1px solid rgba(0,255,127,0.1);
    transition: all 0.3s ease;
  }

  .dev-credit:hover {
    box-shadow: var(--neon-glow);
    transform: translateY(-2px);
  }

  /* Enhanced Status Elements */
  #status {
    color: #00ff7f;
    text-shadow: 0 0 8px rgba(0,255,127,0.8);
    font-weight: 600;
  }

  /* Typing Animation Enhancement */
  .typing {
    position: relative;
  }

  .typing::after {
    content: '‚ñä';
    margin-left: 4px;
    animation: blink 1s steps(2, end) infinite;
    color: #00ff7f;
    text-shadow: 0 0 8px #00ff7f;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Loading Animation */
  .loading-dots {
    display: inline-flex;
    gap: 4px;
  }

  .loading-dots span {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #00ff7f;
    animation: bounce 1.4s infinite ease-in-out;
  }

  .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
  .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

  @keyframes bounce {
    0%, 80%, 100% {
      transform: scale(0.8);
      opacity: 0.5;
    }
    40% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 2000;
    backdrop-filter: blur(5px);
  }

  .modal.show {
    display: flex;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
  }

  .modal-content {
    background: var(--panel-bg);
    backdrop-filter: blur(20px);
    padding: 30px;
    border-radius: 15px;
    border: 1px solid rgba(0,255,127,0.3);
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .modal-title {
    font-size: 20px;
    color: var(--green);
    text-shadow: 0 0 10px rgba(0,255,127,0.5);
  }

  .close-btn {
    background: none;
    border: none;
    color: var(--green);
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
    transition: all 0.3s ease;
  }

  .close-btn:hover {
    color: #ff4444;
    transform: scale(1.2);
  }

  .modal-body {
    color: rgba(0,255,127,0.9);
    line-height: 1.6;
    font-size: 14px;
  }

  /* File Upload Styling */
  .file-upload-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
  }

  .file-upload-label {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background: rgba(0,255,127,0.05);
    border: 1px dashed rgba(0,255,127,0.3);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .file-upload-label:hover {
    background: rgba(0,255,127,0.1);
    border-color: rgba(0,255,127,0.5);
  }

  .file-upload-icon {
    font-size: 18px;
  }

  .file-input {
    display: none;
  }

  .upload-btn {
    background: linear-gradient(135deg, rgba(0,255,127,0.2), rgba(0,255,127,0.1));
    border: 1px solid rgba(0,255,127,0.3);
    color: var(--green);
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s ease;
  }

  .upload-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, rgba(0,255,127,0.3), rgba(0,255,127,0.2));
    box-shadow: 0 0 15px rgba(0,255,127,0.4);
  }

  .upload-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Enhanced Responsive Design */
  @media (max-width: 1024px) {
    .panel {
      grid-template-columns: 1fr;
      gap: 16px;
    }
    
    .sidebar {
      order: 2;
      min-height: auto;
    }
    
    .chat-wrap {
      min-height: 60vh;
    }
    
    header {
      flex-direction: column;
      gap: 12px;
      text-align: center;
    }
  }

  @media (max-width: 768px) {
    .app {
      padding: 12px;
      gap: 16px;
    }
    
    .brand {
      font-size: 20px;
    }
    
    .meta {
      font-size: 12px;
    }
    
    .msg {
      max-width: 92%;
      padding: 12px 16px;
    }
    
    .composer input {
      padding: 14px 16px;
      font-size: 14px;
    }
    
    .composer button {
      padding: 12px 16px;
      font-size: 13px;
    }
  }

  @media (max-width: 480px) {
    .panel {
      width: 100%;
    }
    
    .chat-wrap, .sidebar {
      padding: 16px;
    }
    
    .msg {
      max-width: 95%;
      padding: 10px 14px;
      font-size: 14px;
    }
    
    .key-item {
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }
  }

  /* Theme Variants */
  body.theme-light {
    --bg: #f0f0f0;
    --green: #006400;
    --panel-bg: rgba(255,255,255,0.9);
    --glass: linear-gradient(135deg, rgba(0,0,0,0.05), rgba(0,0,0,0.02));
    --neon-glow: 0 0 10px rgba(0,100,0,0.3);
  }

  body.theme-neon {
    --bg: #0a0014;
    --green: #ff00ff;
    --panel-bg: rgba(10,0,20,0.9);
    --glass: linear-gradient(135deg, rgba(255,0,255,0.1), rgba(255,0,255,0.05));
    --neon-glow: 0 0 10px rgba(255,0,255,0.7), 0 0 20px rgba(255,0,255,0.5);
  }

  body.theme-dark {
    --bg: #111111;
    --green: #00a8ff;
    --panel-bg: rgba(30,30,30,0.9);
    --glass: linear-gradient(135deg, rgba(0,168,255,0.1), rgba(0,168,255,0.05));
    --neon-glow: 0 0 10px rgba(0,168,255,0.5);
  }
</style>
</head>
<body>
<canvas id="matrix"></canvas>

<!-- Login Screen -->
<div class="login-container" id="loginContainer">
  <div class="login-box">
    <div class="brand">ForexBot</div>
    <div class="subtitle">AI Trading Analysis Console</div>
    
    <form id="loginForm" onsubmit="return false;">
      <div class="input-group">
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Enter your username" autocomplete="off" />
      </div>
      
      <div class="input-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" />
      </div>
      
      <button type="button" class="login-btn" onclick="attemptLogin()">
        ACCESS SYSTEM
      </button>
      
      <div class="error-message" id="errorMessage"></div>
    </form>
  </div>
</div>

<!-- Booting Screen -->
<div class="booting-screen" id="bootingScreen">
  <div class="booting-content">
    <div class="booting-header">
      <div class="booting-title">ForexBot System Booting</div>
      <div class="subtitle">Initializing trading analysis engine...</div>
    </div>
    
    <div class="booting-progress">
      <div class="booting-progress-bar" id="bootingProgress"></div>
    </div>
    
    <div class="booting-steps" id="bootingSteps">
      <!-- Steps will be populated by JavaScript -->
    </div>
    
    <div class="booting-error" id="bootingError">
      <div class="error-icon">‚ö†Ô∏è</div>
      <div>Network connection required. Please check your WiFi or mobile data.</div>
      <button class="small-btn" onclick="retryBooting()" style="margin-top: 10px;">Retry Connection</button>
    </div>
  </div>
</div>

<!-- Main App (Hidden Initially) -->
<div class="app" id="mainApp">
  <!-- Menu Button -->
  <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>

  <!-- Dropdown Menu -->
  <div class="dropdown-menu" id="dropdownMenu">
    <div class="menu-item" onclick="showAbout()">About</div>
    <div class="menu-item" onclick="toggleThemeOptions()">Ganti Theme</div>
    <div class="theme-options" id="themeOptions">
      <button class="theme-btn" onclick="changeTheme('default')">Default (Matrix)</button>
      <button class="theme-btn" onclick="changeTheme('light')">Light Mode</button>
      <button class="theme-btn" onclick="changeTheme('neon')">Neon Pink</button>
      <button class="theme-btn" onclick="changeTheme('dark')">Dark Blue</button>
    </div>
  </div>

  <header>
    <div>
      <div class="brand">ForexBot</div>
      <div class="meta">AI Trading Analysis Console ‚Äî HFM, Headway, Exness</div>
    </div>
    <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; justify-content:center;">
      <div style="font-size:13px; color:rgba(0,255,127,0.9)">Status: <span id="status">Ready</span></div>
      <button id="toggleRain" class="small-btn" title="Toggle matrix rain">Rain: ON</button>
    </div>
  </header>

  <main class="panel">
    <section class="chat-wrap" aria-label="Chat area">
      <div id="chat" class="chat-window" role="log" aria-live="polite" aria-relevant="additions"></div>

      <div style="margin-top:8px">
        <form id="composer" class="composer" onsubmit="return false;">
          <input id="inputBox" placeholder="Tanya analisis trading atau upload gambar candlestick..." aria-label="Pesan" autocomplete="off" />
          <button id="sendBtn" type="button">
            <span id="sendText">KIRIM</span>
            <span id="sendLoading" style="display:none;" class="loading-dots">
              <span></span>
              <span></span>
              <span></span>
            </span>
          </button>
        </form>
        
        <div class="file-upload-container">
          <label for="imageUpload" class="file-upload-label">
            <span class="file-upload-icon">üì∑</span>
            <span>Upload Gambar Candlestick untuk Analisis</span>
          </label>
          <input type="file" id="imageUpload" class="file-input" accept="image/*" />
          <button id="uploadBtn" class="upload-btn" disabled>Analisis Gambar</button>
        </div>
      </div>
    </section>

    <aside class="sidebar" aria-label="Controls & keys">
      <div>
        <div class="panel-title">Connection</div>
        <div style="font-size:14px; color:rgba(0,255,127,0.9); margin-bottom:8px;">
          Model: <strong id="modelName">gemini-2.5-flash-preview-09-2025</strong>
        </div>
        <div style="font-size:13px; color:rgba(0,255,127,0.78);">
          Max tokens: <strong id="maxTokens">2048</strong>
        </div>
      </div>

      <div>
        <div class="panel-title">Broker Support</div>
        <div class="key-list">
          <div class="key-item">
            <div>HFM</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ Supported</div>
          </div>
          <div class="key-item">
            <div>Headway</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ Supported</div>
          </div>
          <div class="key-item">
            <div>Exness</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ Supported</div>
          </div>
        </div>
      </div>

      <div>
        <div class="panel-title">Analisis Tersedia</div>
        <div class="key-list">
          <div class="key-item">
            <div>Analisis Teknikal</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ</div>
          </div>
          <div class="key-item">
            <div>Analisis Candlestick</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ</div>
          </div>
          <div class="key-item">
            <div>Analisis Fundamental</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ</div>
          </div>
          <div class="key-item">
            <div>Analisis Gambar</div>
            <div style="color:rgba(0,255,127,0.7);">‚úÖ</div>
          </div>
        </div>
      </div>

      <div>
        <div class="panel-title">Tips Trading</div>
        <ol style="margin:0; padding-left:20px; color:rgba(0,255,127,0.8); font-size:13px; line-height:1.5;">
          <li style="margin-bottom:6px;">Gunakan risk management yang tepat.</li>
          <li style="margin-bottom:6px;">Analisis konfirmasi dari beberapa timeframe.</li>
          <li>Jangan trading berdasarkan emosi.</li>
        </ol>
      </div>
    </aside>
  </main>

  <div class="dev-credit">‚Äî Developed by Roziq ‚Äî</div>
</div>

<!-- About Modal -->
<div class="modal" id="aboutModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">About ForexBot</div>
      <button class="close-btn" onclick="closeAbout()">√ó</button>
    </div>
    <div class="modal-body">
      <p><strong>ForexBot - AI Trading Analysis Console</strong></p>
      <br>
      <p><strong>Deskripsi:</strong><br>
      ForexBot adalah console AI khusus analisis trading forex dengan tampilan Matrix-style yang terintegrasi dengan Google Gemini API. Aplikasi ini memberikan analisis trading untuk broker HFM, Headway, dan Exness dengan fitur analisis gambar candlestick.</p>
      <br>
      <p><strong>Developer:</strong><br>
      Roziq - Full Stack Developer</p>
      <br>
      <p><strong>Rilis Pertama:</strong><br>
      Desember 2024</p>
      <br>
      <p><strong>Fitur Utama:</strong><br>
      ‚Ä¢ Interface Matrix-style<br>
      ‚Ä¢ Integrasi Google Gemini<br>
      ‚Ä¢ Analisis trading untuk HFM, Headway, Exness<br>
      ‚Ä¢ Analisis gambar candlestick<br>
      ‚Ä¢ Analisis teknikal & fundamental<br>
      ‚Ä¢ Responsive design<br>
      ‚Ä¢ Custom themes</p>
    </div>
  </div>
</div>

<script>
// =========================
// Configuration
// =========================
const CONFIG = {
  APP_NAME: 'ForexBot',
  MODEL_NAME: 'gemini-2.5-flash-preview-09-2025',
  MAX_TOKENS: 2048,
  API_KEYS: [
    "AIzaSyAN7OhabuFKH9-LRrBvb4hRVdcMiTw_dmo",
    "AIzaSyC9cVU2p0SwHarQ4tDbYcstPnoKswOPb5U", 
    "AIzaSyBaX_MqkzbVPeB7LCAPo5n_oLYbBs75fO0",
    "AIzaSyCAUfB30nezOYK_r5DwoRIdajSXNCftwps"
  ],
  SYSTEM_PROMPT: "Anda adalah ForexBot, asisten analisis trading forex berbahasa Indonesia yang ahli dalam analisis teknikal, candlestick, dan fundamental. Fokus pada broker HFM, Headway, dan Exness. Berikan analisis yang jelas dengan rekomendasi BUY/SELL jika ada sinyal kuat."
};

// =========================
// Login Functions
// =========================
const CORRECT_USERNAME = 'zix';
const CORRECT_PASSWORD = 'gpt';

function attemptLogin() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const errorMessage = document.getElementById('errorMessage');
  
  if (username === CORRECT_USERNAME && password === CORRECT_PASSWORD) {
    // Login berhasil
    errorMessage.textContent = '';
    errorMessage.style.color = '#00ff7f';
    errorMessage.textContent = '‚úì Access granted! Starting boot sequence...';
    
    // Start booting process
    setTimeout(() => {
      document.getElementById('loginContainer').style.display = 'none';
      startBootingSequence();
    }, 1000);
    
  } else {
    // Login gagal
    errorMessage.style.color = '#ff4444';
    
    if (username !== CORRECT_USERNAME && password !== CORRECT_PASSWORD) {
      errorMessage.textContent = '‚ùå Username dan password salah!';
    } else if (username !== CORRECT_USERNAME) {
      errorMessage.textContent = '‚ùå Username salah!';
    } else {
      errorMessage.textContent = '‚ùå Password salah!';
    }
    
    // Shake effect
    document.getElementById('loginForm').style.animation = 'shake 0.5s ease';
    setTimeout(() => {
      document.getElementById('loginForm').style.animation = '';
    }, 500);
  }
}

// =========================
// Booting Sequence Functions
// =========================
function startBootingSequence() {
  const bootingScreen = document.getElementById('bootingScreen');
  const bootingSteps = document.getElementById('bootingSteps');
  const bootingProgress = document.getElementById('bootingProgress');
  const bootingError = document.getElementById('bootingError');
  
  // Show booting screen
  bootingScreen.classList.add('active');
  bootingError.classList.remove('active');
  
  // Define booting steps
  const steps = [
    { id: 'device', text: 'Detecting device and platform...', duration: 2000 },
    { id: 'security', text: 'Initializing security protocols...', duration: 2500 },
    { id: 'encryption', text: 'Setting up data encryption...', duration: 1800 },
    { id: 'network', text: 'Checking network connectivity...', duration: 3000 },
    { id: 'api', text: 'Connecting to AI services...', duration: 2200 },
    { id: 'trading', text: 'Loading trading analysis engine...', duration: 2000 },
    { id: 'ui', text: 'Loading user interface...', duration: 1500 }
  ];
  
  // Create step elements
  bootingSteps.innerHTML = '';
  steps.forEach(step => {
    const stepEl = document.createElement('div');
    stepEl.className = 'booting-step';
    stepEl.id = `step-${step.id}`;
    stepEl.innerHTML = `
      <div class="step-icon">‚è≥</div>
      <div class="step-text">${step.text}</div>
      <div class="step-status">Waiting...</div>
    `;
    bootingSteps.appendChild(stepEl);
  });
  
  let currentStep = 0;
  let totalDuration = steps.reduce((sum, step) => sum + step.duration, 0);
  let elapsedTime = 0;
  
  function executeStep(stepIndex) {
    if (stepIndex >= steps.length) {
      // All steps completed
      setTimeout(() => {
        bootingScreen.classList.remove('active');
        document.getElementById('mainApp').classList.add('active');
        initForexBot();
      }, 1000);
      return;
    }
    
    const step = steps[stepIndex];
    const stepEl = document.getElementById(`step-${step.id}`);
    const stepStatus = stepEl.querySelector('.step-status');
    
    // Mark step as active
    stepEl.classList.add('active');
    stepStatus.textContent = 'Processing...';
    
    // Simulate step processing
    const stepStartTime = Date.now();
    
    function updateProgress() {
      const now = Date.now();
      const stepElapsed = now - stepStartTime;
      elapsedTime += 16; // ~60fps
      
      // Update progress bar
      const progress = (elapsedTime / totalDuration) * 100;
      bootingProgress.style.width = Math.min(progress, 100) + '%';
      
      // Check for network connectivity on network step
      if (step.id === 'network') {
        checkNetworkConnectivity().then(hasConnection => {
          if (!hasConnection) {
            stepStatus.textContent = 'Failed - No network';
            stepEl.classList.remove('active');
            stepEl.classList.add('completed');
            bootingError.classList.add('active');
            return;
          }
        });
      }
      
      // Device detection on first step
      if (step.id === 'device') {
        detectDevice();
      }
      
      if (stepElapsed < step.duration) {
        requestAnimationFrame(updateProgress);
      } else {
        // Step completed
        stepEl.classList.remove('active');
        stepEl.classList.add('completed');
        stepStatus.textContent = 'Completed ‚úì';
        stepEl.querySelector('.step-icon').textContent = '‚úì';
        
        // Move to next step
        currentStep++;
        executeStep(currentStep);
      }
    }
    
    updateProgress();
  }
  
  // Start first step
  executeStep(0);
}

function detectDevice() {
  const deviceInfo = {
    isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
    platform: navigator.platform,
    userAgent: navigator.userAgent,
    language: navigator.language,
    cores: navigator.hardwareConcurrency || 'Unknown',
    memory: navigator.deviceMemory || 'Unknown'
  };
  
  const stepEl = document.getElementById('step-device');
  const stepStatus = stepEl.querySelector('.step-status');
  
  let deviceType = 'Desktop';
  if (deviceInfo.isMobile) {
    deviceType = /iPad/i.test(navigator.userAgent) ? 'Tablet' : 'Mobile';
  }
  
  stepStatus.textContent = `${deviceType} - ${deviceInfo.cores} cores`;
}

async function checkNetworkConnectivity() {
  try {
    // Try to fetch a small resource from a reliable CDN
    const response = await fetch('https://www.google.com/favicon.ico', { 
      method: 'HEAD',
      mode: 'no-cors',
      cache: 'no-cache'
    });
    return true;
  } catch (error) {
    // If fetch fails, try using navigator.onLine as fallback
    return navigator.onLine;
  }
}

function retryBooting() {
  const bootingError = document.getElementById('bootingError');
  bootingError.classList.remove('active');
  startBootingSequence();
}

// =========================
// Menu & Theme Functions
// =========================
function toggleMenu() {
  const menu = document.getElementById('dropdownMenu');
  menu.classList.toggle('show');
}

function toggleThemeOptions() {
  const options = document.getElementById('themeOptions');
  options.classList.toggle('show');
}

function showAbout() {
  document.getElementById('aboutModal').classList.add('show');
  toggleMenu();
}

function closeAbout() {
  document.getElementById('aboutModal').classList.remove('show');
}

function changeTheme(theme) {
  document.body.className = '';
  
  switch(theme) {
    case 'light':
      document.body.classList.add('theme-light');
      break;
    case 'neon':
      document.body.classList.add('theme-neon');
      break;
    case 'dark':
      document.body.classList.add('theme-dark');
      break;
    default:
      document.body.classList.add('theme-default');
  }
  
  toggleMenu();
}

// =========================
// Matrix Background
// =========================
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
let matrixOn = true;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  columns = Math.floor(canvas.width / fontSize);
  drops = new Array(columns).fill(1);
}

window.addEventListener('resize', resize);

const fontSize = 16;
let columns = Math.floor(window.innerWidth / fontSize);
let drops = new Array(columns).fill(1);
const charset = "„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥0123456789@#$%&*‚òÖ‚òÜ";

function draw() {
  if (!matrixOn) return;
  
  ctx.fillStyle = "rgba(0, 0, 0, 0.08)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--green');
  ctx.font = `600 ${fontSize}px 'Share Tech Mono', monospace`;
  ctx.shadowBlur = 8;
  ctx.shadowColor = getComputedStyle(document.documentElement).getPropertyValue('--green');

  for (let i = 0; i < drops.length; i++) {
    const text = charset.charAt(Math.floor(Math.random() * charset.length));
    const x = i * fontSize;
    const y = drops[i] * fontSize;
    
    ctx.fillText(text, x, y);

    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
      drops[i] = 0;
    }
    drops[i]++;
  }
  
  ctx.shadowBlur = 0;
}

let matrixInterval = setInterval(draw, 40);
resize();

// =========================
// ForexBot Main Application
// =========================
function initForexBot() {
  // UI Elements
  const statusEl = document.getElementById('status');
  const chatEl = document.getElementById('chat');
  const inputBox = document.getElementById('inputBox');
  const sendBtn = document.getElementById('sendBtn');
  const sendText = document.getElementById('sendText');
  const sendLoading = document.getElementById('sendLoading');
  const modelNameEl = document.getElementById('modelName');
  const maxTokensEl = document.getElementById('maxTokens');
  const toggleRainBtn = document.getElementById('toggleRain');
  const imageUpload = document.getElementById('imageUpload');
  const uploadBtn = document.getElementById('uploadBtn');

  modelNameEl.textContent = CONFIG.MODEL_NAME;
  maxTokensEl.textContent = CONFIG.MAX_TOKENS;

  // Matrix Toggle
  toggleRainBtn.addEventListener('click', () => {
    matrixOn = !matrixOn;
    toggleRainBtn.textContent = 'Rain: ' + (matrixOn ? 'ON' : 'OFF');
    toggleRainBtn.style.background = matrixOn 
      ? 'rgba(0,255,127,0.2)' 
      : 'rgba(255,100,100,0.2)';
    if (!matrixOn) { 
      ctx.clearRect(0, 0, canvas.width, canvas.height); 
    }
  });

  // Image Upload Handling
  let uploadedImage = null;
  
  imageUpload.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        uploadedImage = event.target.result;
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Analisis Gambar (Siap)';
      };
      reader.readAsDataURL(file);
    }
  });

  uploadBtn.addEventListener('click', function() {
    if (uploadedImage) {
      analyzeImage(uploadedImage);
    }
  });

  // Conversation Management
  let conversation = [];

  function appendMessage(role, text, cls, imageData = null) {
    const el = document.createElement('div');
    el.className = `msg ${cls}`;
    el.textContent = text;
    
    if (imageData) {
      const img = document.createElement('img');
      img.src = imageData;
      img.className = 'msg-image';
      img.alt = 'Uploaded chart';
      el.appendChild(img);
    }
    
    chatEl.appendChild(el);
    chatEl.scrollTop = chatEl.scrollHeight;
    return el;
  }

  function streamType(el, text, speed = 16) {
    return new Promise(resolve => {
      el.classList.add('ai', 'typing');
      el.textContent = '';
      let i = 0;
      
      const typeInterval = setInterval(() => {
        if (i < text.length) {
          el.textContent += text.charAt(i++);
          chatEl.scrollTop = chatEl.scrollHeight;
        } else {
          clearInterval(typeInterval);
          el.classList.remove('typing');
          resolve();
        }
      }, speed);
    });
  }

  function setLoadingState(loading) {
    if (loading) {
      sendText.style.display = 'none';
      sendLoading.style.display = 'inline-flex';
      sendBtn.disabled = true;
      inputBox.disabled = true;
      uploadBtn.disabled = true;
    } else {
      sendText.style.display = 'inline';
      sendLoading.style.display = 'none';
      sendBtn.disabled = false;
      inputBox.disabled = false;
      uploadBtn.disabled = !uploadedImage;
    }
  }

  // API Communication
  let keyIndex = 0;

  function pickKey() {
    if (!Array.isArray(CONFIG.API_KEYS) || CONFIG.API_KEYS.length === 0) return null;
    keyIndex = (keyIndex + 1) % CONFIG.API_KEYS.length;
    return CONFIG.API_KEYS[keyIndex];
  }

  async function callGemini(payload, apiKey) {
    const url = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(CONFIG.MODEL_NAME)}:generateContent?key=${encodeURIComponent(apiKey)}`;
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    return res;
  }

  async function handleSend() {
    const text = inputBox.value.trim();
    if (!text) return;
    
    appendMessage('user', text, 'user');
    inputBox.value = '';
    setLoadingState(true);
    statusEl.textContent = 'Thinking...';

    conversation.push({ role: 'user', parts: [{ text }] });

    const placeholder = document.createElement('div');
    placeholder.className = 'msg ai typing';
    placeholder.innerHTML = 'AI sedang menganalisis...<span class="loading-dots"><span></span><span></span><span></span></span>';
    chatEl.appendChild(placeholder);
    chatEl.scrollTop = chatEl.scrollHeight;

    const payload = {
      contents: conversation,
      systemInstruction: { parts: [{ text: CONFIG.SYSTEM_PROMPT }] },
      generationConfig: { maxOutputTokens: CONFIG.MAX_TOKENS }
    };

    let attempts = 0;
    const maxAttempts = Math.max(3, (CONFIG.API_KEYS.length || 1) * 3);
    let lastErr = null;

    while (attempts < maxAttempts) {
      attempts++;
      const key = pickKey();
      
      if (!key) {
        lastErr = new Error('Tidak ada API key terpasang.');
        break;
      }

      try {
        statusEl.textContent = `Mencoba... (${attempts}/${maxAttempts})`;
        const res = await callGemini(payload, key);
        
        if (!res.ok) {
          let errText = `HTTP ${res.status}`;
          try { 
            const j = await res.json(); 
            errText += ' ‚Äî ' + (j.error?.message || JSON.stringify(j)); 
          } catch(e) {}
          throw new Error(errText);
        }

        const json = await res.json();
        const candidate = json.candidates && json.candidates[0];
        const aiText = candidate?.content?.parts?.[0]?.text;
        
        if (!aiText) throw new Error('Respon kosong');

        if (chatEl.contains(placeholder)) chatEl.removeChild(placeholder);
        
        const aiDiv = document.createElement('div');
        
        // Determine message class based on content
        let msgClass = 'ai';
        if (aiText.includes('BUY') || aiText.includes('BELI')) {
          msgClass = 'trade-buy';
        } else if (aiText.includes('SELL') || aiText.includes('JUAL')) {
          msgClass = 'trade-sell';
        }
        
        aiDiv.className = `msg ${msgClass}`;
        chatEl.appendChild(aiDiv);
        
        await streamType(aiDiv, aiText, 12);
        conversation.push({ role: 'model', parts: [{ text: aiText }] });
        
        statusEl.textContent = 'Ready';
        setLoadingState(false);
        inputBox.focus();
        return;

      } catch (err) {
        console.warn('Attempt', attempts, 'failed:', err);
        lastErr = err;
        await new Promise(r => setTimeout(r, Math.min(1000 * Math.pow(2, attempts), 8000)));
      }
    }

    if (chatEl.contains(placeholder)) chatEl.removeChild(placeholder);
    appendMessage('ai', `[ERROR] Gagal menghubungi Gemini. ${lastErr?.message || ''}`, 'error');
    statusEl.textContent = 'Error';
    setLoadingState(false);
    inputBox.focus();
  }

  async function analyzeImage(imageData) {
    setLoadingState(true);
    statusEl.textContent = 'Analyzing image...';
    
    appendMessage('user', '[Gambar Candlestick]', 'user', imageData);
    
    const placeholder = document.createElement('div');
    placeholder.className = 'msg ai typing';
    placeholder.innerHTML = 'Menganalisis pola candlestick...<span class="loading-dots"><span></span><span></span><span></span></span>';
    chatEl.appendChild(placeholder);
    chatEl.scrollTop = chatEl.scrollHeight;

    // Prepare payload for image analysis
    const payload = {
      contents: [
        {
          parts: [
            {
              text: "Analisis gambar candlestick ini dan berikan rekomendasi trading (BUY/SELL) dengan penjelasan pola candlestick yang teridentifikasi, level support/resistance, dan risk management yang disarankan."
            },
            {
              inline_data: {
                mime_type: "image/jpeg",
                data: imageData.split(',')[1] // Remove data:image/jpeg;base64, part
              }
            }
          ]
        }
      ],
      systemInstruction: { parts: [{ text: CONFIG.SYSTEM_PROMPT }] },
      generationConfig: { maxOutputTokens: CONFIG.MAX_TOKENS }
    };

    let attempts = 0;
    const maxAttempts = Math.max(3, (CONFIG.API_KEYS.length || 1) * 3);
    let lastErr = null;

    while (attempts < maxAttempts) {
      attempts++;
      const key = pickKey();
      
      if (!key) {
        lastErr = new Error('Tidak ada API key terpasang.');
        break;
      }

      try {
        statusEl.textContent = `Menganalisis gambar... (${attempts}/${maxAttempts})`;
        const res = await callGemini(payload, key);
        
        if (!res.ok) {
          let errText = `HTTP ${res.status}`;
          try { 
            const j = await res.json(); 
            errText += ' ‚Äî ' + (j.error?.message || JSON.stringify(j)); 
          } catch(e) {}
          throw new Error(errText);
        }

        const json = await res.json();
        const candidate = json.candidates && json.candidates[0];
        const aiText = candidate?.content?.parts?.[0]?.text;
        
        if (!aiText) throw new Error('Respon kosong');

        if (chatEl.contains(placeholder)) chatEl.removeChild(placeholder);
        
        const aiDiv = document.createElement('div');
        
        // Determine message class based on content
        let msgClass = 'ai';
        if (aiText.includes('BUY') || aiText.includes('BELI')) {
          msgClass = 'trade-buy';
        } else if (aiText.includes('SELL') || aiText.includes('JUAL')) {
          msgClass = 'trade-sell';
        }
        
        aiDiv.className = `msg ${msgClass}`;
        chatEl.appendChild(aiDiv);
        
        await streamType(aiDiv, aiText, 12);
        conversation.push({ role: 'model', parts: [{ text: aiText }] });
        
        // Reset image upload
        uploadedImage = null;
        imageUpload.value = '';
        uploadBtn.disabled = true;
        uploadBtn.textContent = 'Analisis Gambar';
        
        statusEl.textContent = 'Ready';
        setLoadingState(false);
        inputBox.focus();
        return;

      } catch (err) {
        console.warn('Attempt', attempts, 'failed:', err);
        lastErr = err;
        await new Promise(r => setTimeout(r, Math.min(1000 * Math.pow(2, attempts), 8000)));
      }
    }

    if (chatEl.contains(placeholder)) chatEl.removeChild(placeholder);
    appendMessage('ai', `[ERROR] Gagal menganalisis gambar. ${lastErr?.message || ''}`, 'error');
    statusEl.textContent = 'Error';
    setLoadingState(false);
    inputBox.focus();
  }

  // Event Listeners
  sendBtn.addEventListener('click', handleSend);

  inputBox.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  });

  // Initial Message
  appendMessage('system', '[System] üöÄ ForexBot Console Activated\nAnalisis Trading untuk HFM, Headway, Exness\nDeveloped by Roziq', 'system');
  inputBox.focus();

  // Close menu when clicking outside
  document.addEventListener('click', function(event) {
    const menu = document.getElementById('dropdownMenu');
    const menuBtn = document.querySelector('.menu-btn');
    
    if (!menu.contains(event.target) && !menuBtn.contains(event.target)) {
      menu.classList.remove('show');
      document.getElementById('themeOptions').classList.remove('show');
    }
  });

  // Close modal when clicking outside
  document.getElementById('aboutModal').addEventListener('click', function(event) {
    if (event.target === this) {
      closeAbout();
    }
  });
}

// =========================
// Initialization
// =========================
document.getElementById('password').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    attemptLogin();
  }
});

window.addEventListener('load', function() {
  document.getElementById('username').focus();
});

// Cleanup
window.addEventListener('beforeunload', () => {
  clearInterval(matrixInterval);
});
</script>
</body>
</html>